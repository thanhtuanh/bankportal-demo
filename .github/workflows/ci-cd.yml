name: Bank Portal CI/CD Pipeline

on:
  push:
  pull_request:
  workflow_dispatch:

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}
  NODE_VERSION: '18'
  JAVA_VERSION: '17'

jobs:
  frontend-build:
    name: Frontend Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
      
      - name: Build Frontend
        working-directory: ./frontend
        run: |
          echo "ðŸ”§ Building Frontend..."
          npm ci --legacy-peer-deps
          npm run build:prod
          echo "âœ… Frontend build completed!"

  auth-service-build:
    name: Auth Service Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
      
      - name: Build Auth Service
        working-directory: ./auth-service
        run: |
          echo "ðŸ”§ Building Auth Service..."
          mvn clean compile -DskipTests
          mvn package -DskipTests
          echo "âœ… Auth Service build completed!"

  account-service-build:
    name: Account Service Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
      
      - name: Build Account Service
        working-directory: ./account-service
        run: |
          echo "ðŸ”§ Building Account Service..."
          mvn clean compile -DskipTests
          mvn package -DskipTests
          echo "âœ… Account Service build completed!"

  build-report:
    name: Build Report
    runs-on: ubuntu-latest
    needs: [frontend-build, auth-service-build, account-service-build]
    steps:
      - name: Generate Report
        run: |
          echo "ðŸŽ‰ All builds completed successfully!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ“Š Build Status" >> $GITHUB_STEP_SUMMARY
          echo "| Service | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|---------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Frontend | âœ… Success |" >> $GITHUB_STEP_SUMMARY
          echo "| Auth Service | âœ… Success |" >> $GITHUB_STEP_SUMMARY
          echo "| Account Service | âœ… Success |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸš€ **Ready for deployment!**" >> $GITHUB_STEP_SUMMARY
